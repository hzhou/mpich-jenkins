include: macros/common.def

page: ch4_ofi.groovy
    &call matrix_pipeline, jenkins_configure
        &call shell
        $call copy_artifacts
        &call shell
            $call git_clone
            $call test_worker

    subcode: copy_artifacts
        copyArtifacts(projectName: 'mpich-jenkins-scripts', target: 'jenkins-scripts')

    subcode: git_clone
        rm -rf mpich
        git clone $(git_repo) mpich
        cd mpich
        git checkout $gitBranch

        ln -s ../jenkins-scripts .
        test_worker=./jenkins-scripts/test-worker.sh

    subcode: test_worker
        export compiler=gnu
        $test_worker -b $gitBranch -h $WORKSPACE/mpich -c $compiler -o $jenkins_configure -m ch4:ofi


#---------------------------------------- 
macros:
    git_repo: https://github.com/hzhou/mpich/
    agent: { label "centos64_review" }
    # jenkins_configure: default, debug, am-only, strict, no-inline, direct-nm, external
    jenkins_configure: default, debug

